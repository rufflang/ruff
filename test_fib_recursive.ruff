# Test recursive fibonacci with JIT compilation
# This is THE critical test for Phase 7 Step 5

print("=== Testing Recursive Fibonacci ===")
print("")

func fib(n) {
    if n <= 1 {
        return n
    }
    return fib(n - 1) + fib(n - 2)
}

# Test basic cases
print("Test 1: Basic fibonacci values")
print("fib(0) =", fib(0))
print("fib(1) =", fib(1))
print("fib(2) =", fib(2))
print("fib(3) =", fib(3))
print("fib(4) =", fib(4))
print("fib(5) =", fib(5))
print("✓ Test 1 passed")
print("")

# Verify correctness for small values
print("Test 2: Verify correctness")
assert fib(0) == 0, "fib(0) failed"
assert fib(1) == 1, "fib(1) failed"
assert fib(2) == 1, "fib(2) failed"
assert fib(3) == 2, "fib(3) failed"
assert fib(4) == 3, "fib(4) failed"
assert fib(5) == 5, "fib(5) failed"
assert fib(6) == 8, "fib(6) failed"
assert fib(7) == 13, "fib(7) failed"
assert fib(8) == 21, "fib(8) failed"
assert fib(9) == 34, "fib(9) failed"
assert fib(10) == 55, "fib(10) failed"
print("✓ Test 2 passed - all values correct")
print("")

# Test medium values
print("Test 3: Medium values (should trigger JIT)")
print("fib(15) =", fib(15))
print("fib(20) =", fib(20))
print("✓ Test 3 passed")
print("")

# The BIG performance test - fib(30)
print("Test 4: CRITICAL PERFORMANCE TEST - fib(30)")
print("This is the benchmark test vs Python!")
print("Python baseline: ~282ms for fib(30)")
print("Target: <50ms (5-10x faster than Python)")
print("")

result := fib(30)
print("fib(30) =", result)
print("")

# Verify correctness
assert result == 832040, "fib(30) returned wrong value!"
print("✓ Test 4 passed")
print("")

# Multiple calls to ensure JIT is stable
print("Test 5: Multiple calls for JIT stability")
for i in range(10) {
    val := fib(10)
    assert val == 55, "fib(10) inconsistent"
}
print("✓ Test 5 passed - JIT is stable!")
print("")

print("=== All Recursive Fibonacci Tests PASSED! ===")
