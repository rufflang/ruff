# Personal Expense Tracker
# Demonstrates: file I/O, user input, parse_float, error handling, accumulator pattern

expenses_file := "/tmp/expenses.txt"

# Initialize expenses file if needed
exists := file_exists(expenses_file)
if exists == "false" {
    write_file(expenses_file, "# Personal Expense Tracker\n# Format: Amount,Description\n")
    print("Created new expense tracker")
}

print("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
print("â•‘   Personal Expense Tracker     â•‘")
print("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("")
print("1. Add expense")
print("2. View all expenses")
print("3. Calculate total")
print("4. Exit")
print("")

choice := input("Select option: ")

# Add expense
if choice == "1" {
    print("\n--- Add New Expense ---")
    
    amount_str := input("Enter amount: $")
    description := input("Enter description: ")
    
    try {
        amount := parse_float(amount_str)
        
        if amount <= 0.0 {
            print("Error: Amount must be positive")
        } else {
            # Save expense
            entry := amount_str + "," + description + "\n"
            append_file(expenses_file, entry)
            print("\nâœ“ Expense added successfully!")
        }
    } except err {
        print("Error: Invalid amount - " + err)
    }
}

# View expenses
if choice == "2" {
    print("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
    print("â•‘       Your Expenses            â•‘")
    print("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    
    try {
        lines := read_lines(expenses_file)
        
        for line in lines {
            if line == "" {
                # Skip empty
            } else {
                print("  " + line)
            }
        }
    } except err {
        print("Error reading expenses: " + err)
    }
}

# Calculate total
if choice == "3" {
    print("\n--- Expense Summary ---")
    
    try {
        content := read_file(expenses_file)
        lines := read_lines(expenses_file)
        
        total := 0.0
        count := 0
        
        # Skip header lines (first 2 lines are comments)
        started := 0
        
        for line in lines {
            if line == "" {
                # Skip empty lines
            } else {
                started := started + 1
                
                if started > 2 {
                    # This is an expense line
                    # Format: amount,description
                    # For demo, we'll just count and display
                    # (Would need split function to extract amount)
                    print("  â€¢ " + line)
                    count := count + 1
                }
            }
        }
        
        if count == 0 {
            print("\nNo expenses recorded yet.")
        } else {
            print("\nTotal expenses: " + count + " entries")
            print("(Sum calculation requires string parsing)")
        }
    } except err {
        print("Error: " + err)
    }
}

# Exit
if choice == "4" {
    print("\nGoodbye! Keep track of those expenses! ğŸ’°")
}
