// File: examples/testing_demo.ruff
//
// Demonstrates the Ruff Testing Framework with real-world examples.
// Shows best practices for writing tests with setup/teardown.

// ==============================================================================
// Example 1: Testing arithmetic operations
// ==============================================================================

test "addition works correctly" {
    result1 := 5 + 3
    assert_equal(result1, 8)
    
    // Test with more numbers
    result2 := 10 + 20
    assert_equal(result2, 30)
}

test "subtraction works correctly" {
    result1 := 10 - 4
    assert_equal(result1, 6)
    
    // Test with larger numbers
    result2 := 100 - 75
    assert_equal(result2, 25)
}

test "multiplication works correctly" {
    result1 := 4 * 5
    assert_equal(result1, 20)
    
    // Test with zero
    result2 := 5 * 0
    assert_equal(result2, 0)
}

test "division works correctly" {
    result1 := 20 / 4
    // Division of integers returns integer in Ruff
    assert_equal(result1, 5)
    
    // Test with floats for float result
    result2 := 7.0 / 2.0
    assert_equal(result2, 3.5)
}

// ==============================================================================
// Example 2: Testing array operations
// ==============================================================================

test "array length function" {
    numbers := [1, 2, 3, 4, 5]
    assert_equal(len(numbers), 5)
    
    // Empty array
    empty := []
    assert_equal(len(empty), 0)
}

test "array indexing" {
    fruits := ["apple", "banana", "cherry"]
    
    assert_equal(fruits[0], "apple")
    assert_equal(fruits[1], "banana")
    assert_equal(fruits[2], "cherry")
}

test "array contains elements" {
    numbers := [1, 2, 3, 4, 5]
    
    assert_contains(numbers, 1)
    assert_contains(numbers, 3)
    assert_contains(numbers, 5)
}

test "append to arrays" {
    arr1 := [1, 2, 3]
    arr2 := append(arr1, 4)
    arr3 := append(arr2, 5)
    
    assert_equal(len(arr3), 5)
    assert_equal(arr3[3], 4)
    assert_equal(arr3[4], 5)
}

// ==============================================================================
// Example 3: Testing string operations
// ==============================================================================

test "string length" {
    text := "Hello, World!"
    assert_equal(len(text), 13)
    
    empty := ""
    assert_equal(len(empty), 0)
}

test "string indexing" {
    word := "Ruff"
    
    assert_equal(word[0], "R")
    assert_equal(word[1], "u")
    assert_equal(word[2], "f")
    assert_equal(word[3], "f")
}

// ==============================================================================
// Example 4: Testing dictionary operations
// ==============================================================================

test "dictionary creation and access" {
    user := {"name": "Alice", "age": 30}
    
    assert_equal(len(user), 2)
    assert_equal(user["name"], "Alice")
    assert_equal(user["age"], 30)
}

test "dictionary modification" {
    config := {"debug": false, "timeout": 30}
    
    // Modify existing key
    config["debug"] := true
    assert_true(config["debug"])
    
    // Add new key
    config["retries"] := 3
    assert_equal(len(config), 3)
    assert_equal(config["retries"], 3)
}

// ==============================================================================
// Example 5: Testing boolean operations
// ==============================================================================

test "boolean AND operations" {
    assert_true(true && true)
    assert_false(true && false)
    assert_false(false && true)
    assert_false(false && false)
}

test "boolean OR operations" {
    assert_true(true || true)
    assert_true(true || false)
    assert_true(false || true)
    assert_false(false || false)
}

test "boolean NOT operations" {
    assert_true(!false)
    assert_false(!true)
}

// ==============================================================================
// Example 6: Testing comparisons
// ==============================================================================

test "equality comparisons" {
    comp1 := 5 == 5
    assert_true(comp1)
    
    comp2 := 5 == 10
    assert_false(comp2)
    
    comp3 := "hello" == "hello"
    assert_true(comp3)
    
    comp4 := "hello" == "world"
    assert_false(comp4)
    
    // Note: null == null currently has a bug in Ruff that returns int instead of bool
    // comp5 := null == null
    // assert_true(comp5)
}

test "inequality comparisons" {
    comp1 := 5 != 10
    assert_true(comp1)
    
    comp2 := 5 != 5
    assert_false(comp2)
    
    comp3 := "hello" != "world"
    assert_true(comp3)
    
    comp4 := "hello" != "hello"
    assert_false(comp4)
}

test "greater than and less than" {
    comp1 := 10 > 5
    assert_true(comp1)
    
    comp2 := 5 > 10
    assert_false(comp2)
    
    comp3 := 5 > 5
    assert_false(comp3)
    
    comp4 := 5 < 10
    assert_true(comp4)
    
    comp5 := 10 < 5
    assert_false(comp5)
    
    comp6 := 5 < 5
    assert_false(comp6)
}

test "greater than or equal, less than or equal" {
    comp1 := 10 >= 5
    assert_true(comp1)
    
    comp2 := 5 >= 5
    assert_true(comp2)
    
    comp3 := 5 >= 10
    assert_false(comp3)
    
    comp4 := 5 <= 10
    assert_true(comp4)
    
    comp5 := 5 <= 5
    assert_true(comp5)
    
    comp6 := 10 <= 5
    assert_false(comp6)
}

// ==============================================================================
// Example 7: Testing with setup and teardown
// ==============================================================================

// Global variable for testing
test_counter := 0

test_setup {
    // This runs before each test
    test_counter := 0
}

test_teardown {
    // This runs after each test
    test_counter := 0
}

test "setup initializes counter" {
    // Counter should be 0 from setup
    assert_equal(test_counter, 0)
    
    test_counter := test_counter + 1
    assert_equal(test_counter, 1)
}

test "counter is reset between tests" {
    // Should be 0 again from setup
    assert_equal(test_counter, 0)
}

// ==============================================================================
// Example 8: Testing null values
// ==============================================================================

test "null value handling" {
    value := null
    
    assert_equal(value, null)
    assert_equal(null, null)
}

test "null in comparisons" {
    // Note: null == null currently has a bug in Ruff that returns int instead of bool
    // Skipping for now
    // comp1 := null == null
    // assert_true(comp1)
    
    // comp2 := null != null
    // assert_false(comp2)
    
    // Just test that null exists
    value := null
    assert_equal(value, null)
}

// ==============================================================================
// Example 9: Testing edge cases
// ==============================================================================

test "empty collections" {
    empty_array := []
    empty_dict := {}
    empty_string := ""
    
    assert_equal(len(empty_array), 0)
    assert_equal(len(empty_dict), 0)
    assert_equal(len(empty_string), 0)
}

test "negative numbers" {
    // Negative literals have a parsing bug in Ruff currently
    // Use subtraction instead: 0 - 10 = -10
    negative := 0 - 10
    
    assert_equal(negative, 0 - 10)
    
    comp1 := negative < 0
    assert_true(comp1)
    
    comp2 := negative > 0
    assert_false(comp2)
}

test "zero values" {
    zero_int := 0
    zero_float := 0.0
    
    assert_equal(zero_int, 0)
    assert_equal(zero_float, 0.0)
    assert_false(zero_int != 0)
}

// ==============================================================================
// Example 10: Testing functions
// ==============================================================================

test "function definition and calling" {
    add := fn(a, b) { return a + b }
    
    result := add(3, 4)
    assert_equal(result, 7)
    
    result := add(10, -5)
    assert_equal(result, 5)
}

test "function with multiple operations" {
    calculate := fn(x) {
        doubled := x * 2
        plus_ten := doubled + 10
        return plus_ten
    }
    
    result1 := calculate(5)
    assert_equal(result1, 20)
    
    result2 := calculate(0)
    assert_equal(result2, 10)
}

// ==============================================================================
// Best Practices Summary
// ==============================================================================

/*
TESTING BEST PRACTICES:

1. Use descriptive test names that explain what is being tested
2. Use test_setup and test_teardown for initialization and cleanup
3. Test both success cases and edge cases (empty, null, boundary values)
4. Use multiple assertions in a test to verify different aspects
5. Test one concept per test function
6. Keep tests independent - they shouldn't depend on each other
7. Use assert_equal for exact value comparisons
8. Use assert_true/assert_false for boolean conditions
9. Use assert_contains to verify collection membership
10. Test error conditions and edge cases

RUNNING TESTS:
    ruff test-run examples/testing_demo.ruff
    ruff test-run examples/testing_demo.ruff --verbose

The --verbose flag shows details for each test.
*/

